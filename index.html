<!DOCTYPE html>
<html>
<head>
    <title>Global Evocation Chat</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a2e; color: white; text-align: center; }
        #chatbox { height: 300px; border: 1px solid #444; overflow-y: scroll; padding: 10px; background: #16213e; margin: 20px auto; width: 80%; }
        input { padding: 10px; border-radius: 5px; border: none; }
        button { padding: 10px; background: #e94560; color: white; border: none; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ðŸ§¬ Global Evocation Chat</h1>
    <div style="background: #0f3460; padding: 10px; margin-bottom: 10px;">
        IL TUO ID: <span id="my-id" style="color: #00ff41; font-weight: bold;">Generazione...</span>
    </div>

    <div id="chatbox"></div>

    <input type="text" id="friend-id" placeholder="Incolla ID amico">
    <button onclick="connetti()">CONNETTI</button>
    <br><br>
    <input type="text" id="msg" placeholder="Scrivi un messaggio...">
    <button onclick="invia()">INVIA</button>

    <script>
        const peer = new Peer();
        let conn;
        let count = 0;

        peer.on('open', id => { document.getElementById('my-id').innerText = id; });
        peer.on('connection', c => { conn = c; setup(); });

        function connetti() {
            conn = peer.connect(document.getElementById('friend-id').value);
            setup();
        }

        function setup() {
            conn.on('data', data => mostra(data, 'Amico'));
            conn.on('open', () => alert("Siete connessi!"));
        }

        function invia() {
            const m = document.getElementById('msg').value;
            if(conn && m) {
                conn.send(m);
                mostra(m, 'Tu');
                document.getElementById('msg').value = '';
            }
        }

        function mostra(t, chi) {
            count++;
            const b = document.getElementById('chatbox');
            b.innerHTML += `<p><b>${chi}:</b> ${t}</p>`;
            if(count % 5 === 0) b.innerHTML += `<h3 style="color:gold;">âœ¨ EVOCAZIONE! âœ¨</h3>`;
            b.scrollTop = b.scrollHeight;
        }
    </script>
</body>
</html>
