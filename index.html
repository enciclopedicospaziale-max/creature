<!DOCTYPE html>
<html>
<head>
    <title>Sogni-Mon Evoluzione</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Courier New', monospace; background: #050505; color: #00ff41; text-align: center; padding: 20px; }
        #chat { height: 250px; border: 1px solid #00ff41; overflow-y: auto; background: #000; margin: 20px auto; width: 90%; padding: 10px; border-radius: 5px; text-align: left; }
        .creatura-box { border: 2px solid #00ff41; padding: 15px; margin-top: 10px; background: #111; border-radius: 15px; display: inline-block; }
        input { background: #000; border: 1px solid #00ff41; color: #00ff41; padding: 10px; width: 60%; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üß¨ GLOBAL EVOCATION SYSTEM</h1>
    <div style="margin-bottom: 10px;">IL TUO ID: <span id="my-id">...</span></div>
    <div id="chat"></div>
    <input type="text" id="friend-id" placeholder="ID Amico">
    <button onclick="connetti()">CONNETTI</button>
    <hr style="border: 0.5px solid #222;">
    <input type="text" id="msg" placeholder="Descrivi il tuo sogno...">
    <button onclick="invia()">INVIA</button>

    <script>
        const peer = new Peer();
        let conn;
        let msgCount = 0;
        let testoTotale = "";

        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', c => { conn = c; setup(); });

        function connetti() {
            conn = peer.connect(document.getElementById('friend-id').value);
            setup();
        }

        function setup() {
            conn.on('data', data => mostra(data, 'Amico'));
            conn.on('open', () => alert("Sincronizzazione neurale completata!"));
        }

        function invia() {
            const m = document.getElementById('msg').value;
            if(conn && m) {
                conn.send(m);
                mostra(m, 'Tu');
                document.getElementById('msg').value = '';
            }
        }

        function mostra(t, chi) {
            msgCount++;
            testoTotale += " " + t.toLowerCase();
            const b = document.getElementById('chat');
            b.innerHTML += `<p>> <b>${chi}:</b> ${t}</p>`;
            
            if(msgCount % 5 === 0) {
                evocaCreatura();
            }
            b.scrollTop = b.scrollHeight;
        }

        function evocaCreatura() {
    const b = document.getElementById('chat');
    // Scegliamo un tema in base alle parole usate
    let tema = "fantasy,monster"; 
    
    if(testoTotale.includes("drago") || testoTotale.includes("fuoco")) tema = "dragon,fire";
    if(testoTotale.includes("cavaliere") || testoTotale.includes("spada")) tema = "knight,armor";
    if(testoTotale.includes("mago") || testoTotale.includes("magia")) tema = "wizard,spell";
    if(testoTotale.includes("oscuro") || testoTotale.includes("morte")) tema = "demon,dark";

    // Dimensione basata sulla lunghezza dei messaggi (fino a 400px per le carte "leggendarie")
    let dimensione = Math.min(400, 200 + (testoTotale.length / 5));
    
    // Usiamo Source Unsplash con filtri fantasy per somigliare a Magic
    const urlImmagine = `https://loremflickr.com/400/600/${tema}/all`;

    b.innerHTML += `
        <div class="creatura-box" style="border: 4px solid #332d21; background: linear-gradient(135deg, #1a1a1a, #2c2c2c); color: #e0e0e0; box-shadow: 0 10px 20px rgba(0,0,0,0.5); padding: 10px; border-radius: 10px; max-width: ${dimensione}px;">
            <h3 style="color: gold; text-transform: uppercase; font-size: 1em;">‚öîÔ∏è Evocazione Magic ‚öîÔ∏è</h3>
            <img src="${urlImmagine}" style="width: 100%; border: 2px solid #000; border-radius: 5px;">
            <p style="font-style: italic; font-size: 0.8em; margin-top: 10px;">"Nata dalle parole: ${testoTotale.substring(0, 30)}..."</p>
        </div>`;
    
    testoTotale = ""; // Reset per la prossima carta
}
        }
    </script>
</body>
</html>

