<!DOCTYPE html>
<html>
<head>
    <title>Sogni-Mon Evoluzione</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Courier New', monospace; background: #050505; color: #00ff41; text-align: center; padding: 20px; }
        #chat { height: 250px; border: 1px solid #00ff41; overflow-y: auto; background: #000; margin: 20px auto; width: 90%; padding: 10px; border-radius: 5px; text-align: left; }
        .creatura-box { border: 2px solid #00ff41; padding: 15px; margin-top: 10px; background: #111; border-radius: 15px; display: inline-block; }
        input { background: #000; border: 1px solid #00ff41; color: #00ff41; padding: 10px; width: 60%; }
        button { background: #00ff41; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ðŸ§¬ GLOBAL EVOCATION SYSTEM</h1>
    <div style="margin-bottom: 10px;">IL TUO ID: <span id="my-id">...</span></div>
    <div id="chat"></div>
    <input type="text" id="friend-id" placeholder="ID Amico">
    <button onclick="connetti()">CONNETTI</button>
    <hr style="border: 0.5px solid #222;">
    <input type="text" id="msg" placeholder="Descrivi il tuo sogno...">
    <button onclick="invia()">INVIA</button>

    <script>
        const peer = new Peer();
        let conn;
        let msgCount = 0;
        let testoTotale = "";

        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', c => { conn = c; setup(); });

        function connetti() {
            conn = peer.connect(document.getElementById('friend-id').value);
            setup();
        }

        function setup() {
            conn.on('data', data => mostra(data, 'Amico'));
            conn.on('open', () => alert("Sincronizzazione neurale completata!"));
        }

        function invia() {
            const m = document.getElementById('msg').value;
            if(conn && m) {
                conn.send(m);
                mostra(m, 'Tu');
                document.getElementById('msg').value = '';
            }
        }

        function mostra(t, chi) {
            msgCount++;
            testoTotale += " " + t.toLowerCase();
            const b = document.getElementById('chat');
            b.innerHTML += `<p>> <b>${chi}:</b> ${t}</p>`;
            
            if(msgCount % 5 === 0) {
                evocaCreatura();
            }
            b.scrollTop = b.scrollHeight;
        }

        function evocaCreatura() {
            const b = document.getElementById('chat');
            let tipo = "set4"; // Default: Kittens
            
            // Logica delle parole magiche
            if(testoTotale.includes("fuoco") || testoTotale.includes("rabbia")) tipo = "set2"; // Mostri
            if(testoTotale.includes("robot") || testoTotale.includes("tecnologia")) tipo = "set1"; // Robot
            if(testoTotale.includes("spazio") || testoTotale.includes("alieno")) tipo = "set5"; // Alieni
            
            // Grandezza basata sulla lunghezza del testo
            let dimensione = Math.min(300, 100 + (testoTotale.length / 2));
            
            const idCreatura = Math.random();
            b.innerHTML += `
                <div class="creatura-box">
                    <h3 style="color: gold;">âœ¨ CREATURA LIVELLO ${msgCount/5} âœ¨</h3>
                    <img src="https://robohash.org/${idCreatura}?set=${tipo}" style="width: ${dimensione}px;">
                    <p>La creatura Ã¨ cresciuta grazie alle vostre parole!</p>
                </div>`;
            testoTotale = ""; // Reset per la prossima evoluzione
        }
    </script>
</body>
</html>
